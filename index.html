<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Third Space – Cellar Tools</title>
<link rel="manifest" href="manifest.json">
<style>
:root {font-family: system-ui, sans-serif;}
body   {margin:0;padding:1rem;background:#f8f8f8}
nav    {display:flex;gap:.5rem;margin-bottom:1rem}
button {flex:1;padding:.6rem;border:1px solid #ccc;border-radius:6px;background:#fff}
section{display:none}
section.active{display:block}
input  {width:6rem}
.card  {background:#fff;padding:1rem;border-radius:8px;box-shadow:0 2px 6px #0002}
</style>
</head>
<body>

<nav>
  <button onclick="show('dilution')">Dilution</button>
  <button onclick="show('ibu')">IBU Adj</button>
</nav>

<!-- ========== CALCULATOR 1 – GRAVITY DILUTION ========== -->
<section id="dilution" class="active card">
  <h2>Gravity Dilution</h2>

  <label>Starting Gravity (°P)
    <input id="g0Input" type="number" step="0.01" required>
  </label><br>

  <label>Starting Volume (bbl)
    <input id="v0Input" type="number" step="0.01" required>
  </label><br>

  <label>Target Gravity (°P)
    <input id="gtInput" type="number" step="0.01" required>
  </label><br>

  <button onclick="goalSeekD6()">Calculate</button>

  <p>
    Water to add: <input id="d6Input" readonly style="width:5rem"> bbl
  </p>
  <p id="d14Output" style="font-size:0.9rem;color:#555"></p>
</section>

<!-- ========== CALCULATOR 2 – placeholder ========== -->
<section id="ibu" class="card">
  <h2>IBU Adjustment</h2>
  <p>Coming soon…</p>
</section>

<script>
/* ---------- Tab switcher ---------- */
function show(id){
  document.querySelectorAll('section')
          .forEach(s => s.classList.toggle('active', s.id === id));
}
/* ---------- element handles ---------- */
const g0El  = document.getElementById('g0Input');
const v0El  = document.getElementById('v0Input');
const gtEl  = document.getElementById('gtInput');
const d6El  = document.getElementById('d6Input');
const d14El = document.getElementById('d14Output');

/* ---------- Excel-equivalent D14 ---------- */
/* Replace this block with your real workbook math if needed. */
function calcD14(d6){
+ const g0 = +g0El.value;
+ const v0 = +v0El.value;
+ const gt = +gtEl.value;


  /* Simple mix: wort + 1 °P water */
  const finalGravity = (g0*v0 + 1*d6) / (v0 + d6);

  return finalGravity - gt;    // should → 0
}

/* ---------- Goal Seek (bisection) ---------- */
function goalSeekD6(){
  if(!(g0Input.value && v0Input.value && gtInput.value)){
    alert("Please enter all three inputs first."); return;
  }

  let low = 0, high = 100, mid = (low+high)/2;
  const tol = 1e-4;

  for(let i=0;i<60;i++){
    const f = calcD14(mid);
    if(Math.abs(f) < tol) break;
    (f > 0 ? low : high) = mid;
    mid = (low+high)/2;
  }

d6El.value      = mid.toFixed(3);
d14El.textContent =
  `Residual: ${calcD14(mid).toFixed(5)} (should be 0)`;

}

/* ---------- Offline support ---------- */
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js');
}
</script>
</body>
</html>
